<div class="container my-5">

  <div class="row">
    <div class="col-12 mb-4">
      <!--Bus Scheduling Form-->
      <div class="card">
        <div class="card-body">
          <div class="mb-3"><h3>Bus Scheduling Form</h3></div>

          <div class="row mb-3">
            <div class="col-md-4">
              <app-location-dropdown
                label="From location"
                icon="fa-map-marker-alt"
                (selectedValueChange)="handleOnChildFromLocation($event)"
                [selectedValue]="dropDownFromLocationValue" ></app-location-dropdown>
            </div>
            <div class="col-md-4">
              <app-location-dropdown
                label="To location"
                icon="fa-map-marker-alt"
                (selectedValueChange)="handleOnChildToLocation($event)"
                [selectedValue]="dropDownToLocationValue"></app-location-dropdown>
            </div>
            <div class="col-md-4">
              <div class="col-12 mb-1 d-flex justify-content-between">
                <!-- single date-->
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="toggleOptions" value="option1"
                    data-bs-toggle="tooltip"data-bs-placement="top" title="Single date scheduling only"
                    (change)="dateRadioChange('option1')">
                  <label class="form-check-label">Single date</label>
                </div>
                <!-- multiple date-->
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="toggleOptions" value="option2"
                    data-bs-toggle="tooltip"data-bs-placement="top" title="Multiple date scheduling"
                    (change)="dateRadioChange('option2')">
                  <label class="form-check-label" for="toggle2">Date range</label>
                </div>
              </div>
              @if (selectedOption == 'option1') {
                <div class="col-6">
                    <input type="date" name="travelDate" [(ngModel)]="busScheduleParams.scheduleDate" class="form-control">
                </div>
              } @else {
                <div class="col-12">
                  <div class="d-flex gap-3">
                    <input type="date" name="dateFrom" class="form-control">
                    <input type="date" name="dateTo" class="form-control" >
                  </div>
                </div>
              }
            </div>
          </div>

          <div class="row mb-4">
            <div class="col-md-4">
              <label for="" class="form-label">Departure time</label>
              <input type="time" [(ngModel)]="busScheduleParams.departureTime" name="departureTime" class="form-control">
            </div>
            <div class="col-md-4">
              <label for="" class="form-label">Arrival time</label>
              <input type="time" [(ngModel)]="busScheduleParams.arrivalTime" name="arrivalTime" class="form-control">
            </div>
            <div class="col-md-4">
              <label for="" class="form-label">Duration</label>
              <input type="text" name="duration" class="form-control"
                [value]="busScheduleParams.departureTime | timeDiff:busScheduleParams.arrivalTime" disabled readonly>
            </div>
          </div>

          <div class="row mb-4">
            <div class="col-md-4">
              <label for="" class="form-label">Bus name</label>
              <select [(ngModel)]="busIndexValue" class="form-select" (change)="onBusChange($event)">
                <option [value]="0">Please Select Bus</option>
                @for (busDetail of busDetails; track $index) {
                  <option [value]="busDetail.id">{{busDetail.bus_full_description}}</option>
                }
              </select>
            </div>
            <div class="col-md-4">
              <label for="" class="form-label">Operator</label>
              <input type="text" name="operatorName" [(ngModel)]="operatorName" [value]="operatorName" class="form-control" disabled readonly>
            </div>
            <div class="col-md-2">
              <label for="" class="form-label">Seat capacity</label>
              <input type="text" name="seatCapacity" [(ngModel)]="seatCapacity" class="form-control" [value]="seatCapacity" disabled readonly>
            </div>
          </div>
          <!-- buttons -->
          <div class="row mb-3">
            <div class="col-md-8"></div>
            <div class="col-md-4 d-grid gap-2 d-md-flex justify-content-md-start">
              <button type="button" class="btn btn-outline-primary" (click)="createBusSchedule()">Save</button>
              <button type="button" class="btn btn-outline-warning">Update</button>
              <button type="button" class="btn btn-outline-danger">Delete</button>
              <button type="button" class="btn btn-outline-secondary">Cancel</button>
            </div>
          </div>
        </div> <!--/.card-body-->
      </div> <!--/.card -->

      <!--Bus Scheduling table-->
      <div class="row mt-5">
        <div class="col-12">
          <h4>Bus Schedules</h4>

          @if (busScheduleList().length > 0) {
            <div class="table-responsive">
              <table class="table table-striped table-bordered align-middle">
                <thead class="table-light">
                  <tr>
                    <th>#</th>
                    <th>From Location</th>
                    <th>To Location</th>
                    <th>Bus Name</th>
                    <th>Operator</th>
                    <th>Schedule Date</th>
                    <th>Departure</th>
                    <th>Arrival</th>
                    <th>Duration</th>
                    <th>Seat Capacity</th>
                    <th>Price</th>
                  </tr>
                </thead>
                <tbody>
                  @for (busSchedule of busScheduleList(); track $index) {
                    <tr>
                      <td>{{ $index + 1}}</td>
                      <td>{{busSchedule.from_bus_location}}</td>
                      <td>{{busSchedule.to_bus_location}}</td>
                      <td>{{busSchedule.bus_full_description}}</td>
                      <td>{{busSchedule.operator}}</td>
                      <td>{{busSchedule.schedule_date}}</td>
                      <td>{{busSchedule.departure_time ? ('1970-01-01T' + busSchedule.departure_time | date:'hh:mm a') : 'No time' }}</td>
                      <td>{{busSchedule.arrival_time ? ('1970-01-01T' + busSchedule.arrival_time | date:'hh:mm a') : 'No time' }}</td>
                      <td>{{busSchedule.departure_time| timeDiff:busSchedule.arrival_time}}</td>
                      <td>{{busSchedule.seat_capacity}}</td>
                      <td>{{busSchedule.price}}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <p class="text-muted">No Bus Schedules added yet..</p>
          }

        </div> <!--/.card-body-->
      </div><!--/.card-->

    </div><!--/.col-12 mb-4-->

  </div>

</div>
