<div class="container my-5">
   <div class="row">
    <!-- Bus Details -->
      <div class="col-12 mb-4">
         <div class="card">
            <div class="card-body">
               <div class="d-flex justify-content-between align-items-center">
                  <div>
                     <h5 class="card-title mb-1">{{busScheduleData().bus_name}}</h5>
                     <h6 class="mb-1">{{busScheduleData().from_bus_location}} <i class="fas fa-long-arrow-alt-right"></i> {{busScheduleData().to_bus_location}}</h6>
                  </div>
                  <div class="text-end">
                     <p class=" mb-0">
                        <i class="bi bi-calendar3 me-2"></i>{{busScheduleData().schedule_date | date:'dd MMM yyyy'}}
                        <span class="mx-2">â€¢</span>
                        <i class="bi bi-clock me-2"></i>
                        <!-- {{busScheduleData().departure_time ? ('1970-01-01T' + busScheduleData().departure_time | date:'hh:mm a') : 'No time' }} -->
                        <span [appTimeFormat]="busScheduleData().departure_time"></span> -
                        <span [appTimeFormat]="busScheduleData().arrival_time"></span>
                     </p>
                     <!-- <p class="mb-0">Duration: {{ busScheduleData().departure_time | timeDiff:busScheduleData().arrival_time }}</p> -->
                      <p class="mb-0">Duration: <span appTimeDifference [departureTime]="busScheduleData().departure_time" [arrivalTime]="busScheduleData().arrival_time"></span>
                      </p>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <!-- Seat Layout -->
      <div class="col-lg-5">
         <div class="card">
            <div class="card-body">

               <div class="d-flex justify-content-between align-items-center mb-4">
                  <h5 class="card-title mb-0">Select Seats</h5>
                  <div class="seat-legend text-center">
                      <span class="me-3 d-inline-flex flex-column align-items-center">
                        <i class="bi bi-square me-1 mb-0"></i>Available
                        <small class="text-muted">{{scheduleBooking().availableSeats}}</small>
                      </span>
                      <span class="me-3 d-inline-flex flex-column align-items-center">
                        <i class="bi bi-square-fill text-secondary me-1"></i>Booked
                        <small class="text-muted">{{scheduleBooking().bookedSeats}}</small>
                      </span>

                      <span class="me-3 d-inline-flex flex-column align-items-center">
                        <i class="bi bi-square-fill text-secondary me-1"></i>Selected
                        <small class="text-muted">{{scheduleBooking().selectedSeats}}</small>
                      </span>
                  </div>
               </div>

              <div class="bus-layout">
                <!-- Driver's Area -->
                  <div class="driver-area mb-4">
                     <div class="steering">
                        <i class="bi bi-truck-front-fill fs-1"></i>
                     </div>
                     <small class="text-muted d-block mt-2">Front</small>
                  </div>
                <!-- Loop for Seats -->
                 @if (showBusSeats) {
                  <div class="deck">
                    <div class="seat-grid">
                      @for (seatNo of seatNumberList(); track $index) {
                        @if (!isSeatBooked(seatNo)) {
                          <button class="seat available"
                              [ngClass]="isSeatSelected(seatNo) ? 'selected' : ''"
                              (click)="onSelectSeat(seatNo)">{{seatNo}}
                          </button>
                        } @else {
                            <button class="seat booked" [disabled]="true"
                              [appTooltip]="getTooltipText(seatNo)" [showDelay]="500" [hideDelay]="5000">
                              {{ seatNo }}
                            </button>
                        }
                      }
                    </div>
                  </div>
                 } @else {
                  <p class="text-muted">Loading bus schedule seats..</p>
                 }
                  <!-- /Seats -->
              </div>
            </div>
         </div>
      </div>

      <!-- Booking Summary-->
      <div class="col-lg-7">
         <div class="card booking-summary">
            <div class="card-body">
               <h5 class="card-title mb-4">Booking Summary</h5>

               <!-- Selected Seats -->
               <div class="selected-seats mb-4">
                  <h6 class="mb-3">Selected Seats</h6>
                  <div id="selectedSeatsList" class="mb-3">
                    @if (selectedSeatArray().length == 0) {
                      <p class="text-muted mb-0">No seats selected</p>
                    } @else {
                     <div class="selected-seat-tags">
                        @for (selectedSeat of selectedSeatArray(); track $index) {
                          <span class="badge bg-primary me-2 mb-2">{{selectedSeat.seat_number}}</span>
                        }
                     </div>
                    }
                  </div>
               </div>
               <!-- Contact Details -->
               <div class="contact-details mb-4">
                  @if (selectedSeatArray.length > 0) {
                    <h6 class="mb-3">Contact Details</h6>
                  }
                  @for (selectedSeat of selectedSeatArray(); track $index) {
                    <div class="row">
                        <div class="col-3">
                          <label class="form-label">Fullname:</label>
                          <input type="text" [(ngModel)]="selectedSeat.fullname" class="form-control" placeholder="First, MI, Last">
                        </div>
                        <div class="col-3">
                          <label for="" class="form-label">Email:</label>
                          <input type="text" [(ngModel)]="selectedSeat.email_address" class="form-control" placeholder="Email address">
                        </div>
                        <div class="col-3">
                          <label class="form-label">Age:</label>
                          <input type="number" [(ngModel)]="selectedSeat.age" class="form-control" placeholder="Enter Age">
                        </div>
                        <div class="col-3">
                          <label class="form-label mb-2">Gender:</label>
                          <div>
                            <input type="radio" [(ngModel)]="selectedSeat.gender" value="M" [name]="'gender'+$index">Male
                            <input type="radio" [(ngModel)]="selectedSeat.gender" value="F" [name]="'gender'+$index">Female
                          </div>
                        </div>
                    </div>
                  }
               </div>

               <button (click)="bookTicket()" type="button" class="btn btn-primary w-100">
                  <i class="bi bi-credit-card me-2"></i>Book Ticket
               </button>

            </div>
         </div>
      </div>
   </div>
</div>
